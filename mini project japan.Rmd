---
title: "mini project ordinal data"
author: "S18827"
date: "2024-04-03"
output: html_document
---


```{r}
# Load necessary libraries
library(psych)  # for EFA
library(lavaan) # for CFA
library(tidyverse)
library(corrplot)

```

https://www.kaggle.com/datasets/gianinamariapetrascu/japan-life-expectancy

```{r}
# Load the dataset
data <- read_csv("Japan_life_expectancy.csv", col_types = 'cdddddddddddddddddddddd')

data <- select(data, -c("Beds_psic", "Nurses", "Elementary_school", "Junior_col", "Density_pop", "Income_per capita", "Beds", "Ambulances", "Pshic_hosp", "Hospitals", "Prefecture"))

#data <- select(data, -'Timestamp')
# Check the structure of the dataset
str(data)

#describe(data)
```


```{r}
colSums(is.na(data)) # Count # missing in each column
```

```{r}
# Exclude non-numeric columns
numeric_data <- data[, sapply(data, is.numeric)]

standardized_data <- scale(numeric_data)
# Compute KMO
kmo_result <- KMO(standardized_data)
print(kmo_result)
```


```{r}
standardized_data <- standardized_data[, KMO(standardized_data)$MSAi > 0.5] # Get rid of all variables with MSA < 0.50
kmo_result <- KMO(standardized_data)
print(kmo_result)
```
```{r}
cortest.bartlett(standardized_data)
```
In your case, the test statistic (chi-square) is 4289.388 with 136 degrees of freedom, and the p-value is 0. With such a small p-value (less than any reasonable significance level, such as 0.05), you would reject the null hypothesis. Therefore, you have sufficient evidence to conclude that the correlation matrix is significantly different from an identity matrix, indicating that there are significant correlations among the variables in your dataset.



```{r}
cor(standardized_data)
```
```{r}

# Compute the correlation matrix
correlation_matrix <- cor(standardized_data)

# Create a correlation plot
corrplot(correlation_matrix, method = "circle", type = "upper", tl.col = "black")

```


```{r}
# Perform Exploratory Factor Analysis
efa_result <- fa(standardized_data, nfactors = 3, rotate = "varimax")

# View the results
print(efa_result)
```

```{r}
# Extract eigenvalues
eigenvalues <- efa_result$values

# Print the eigenvalues
print(eigenvalues)

```
```{r}
plot(1:length(eigenvalues), eigenvalues, type = "b", 
      xlab = "Factor", ylab = "Eigenvalue", 
      main = "Scree Plot")
```



```{r}
# Extract communality
communality <- efa_result$communality
print(communality)
```
```{r}
# Calculate specific variance
specific_variance <- 1 - communality

# Print specific variance
print(specific_variance)

```

```{r}
# Get the proportion of variance explained by each factor
variance_explained <- efa_result$Vaccounted

# Print the percentage of variance explained by each factor
print(variance_explained)

```


```{r}
# Extract cumulative proportions
proportions <- eigenvalues / sum(eigenvalues)


# Print cumulative proportions
print(proportions)
```


```{r}
# Get factor loadings
factor_loadings <- efa_result$loadings
print(factor_loadings)
```
```{r}
# Calculate the factor matrix
factor_matrix <- t(factor_loadings) %*% factor_loadings

# Print the factor matrix
print(factor_matrix)

```

